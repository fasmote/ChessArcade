<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Memory Matrix - Con Chessboard2.js - ChessArcade</title>
    <meta name="description" content="Memory Matrix usando Chess.js y Chessboard2.js - La versi√≥n m√°s f√°cil de usar.">

    <!-- OBLIGATORIOS: Google AdSense + Analytics -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2472413468382197" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-N3EKXHPD5Y"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-N3EKXHPD5Y');
    </script>

    <!-- Fuentes y estilos principales -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">

    <!--
        CHESSBOARD.JS CSS - Versi√≥n CDN oficial
        Misma librer√≠a que usa tu implementaci√≥n de referencia
    -->
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">

    <!--
        Estilos compartidos de ChessArcade
        Mantienen la coherencia visual con el resto del sitio
    -->
    <link rel="stylesheet" href="../../../assets/css/chessarcade-shared.css">

    <!--
        Estilos espec√≠ficos para la versi√≥n Chessboard2
        Aqu√≠ customizamos los colores ne√≥n y efectos visuales
    -->
    <link rel="stylesheet" href="memory-matrix-cb2.css?v=20250926012345">
</head>

<body>
    <!--
        Container principal con clase ChessArcade
        chess-arcade-bg aplica el fondo animado de grid
    -->
    <div class="game-container chess-arcade-bg">

        <!-- OBLIGATORIOS: Botones flotantes de navegaci√≥n -->
        <div class="home-toggle" id="homeBtn" title="Volver al inicio">üè†</div>
        <div class="sound-toggle" id="soundToggle" title="Toggle Sound">üîä</div>

        <!-- Header del juego con t√≠tulo animado -->
        <div class="game-header">
            <div class="game-title">üß† MEMORY MATRIX</div>
            <div class="game-subtitle">Versi√≥n con Chess.js + Chessboard2.js</div>
        </div>

        <!--
            Panel de informaci√≥n del nivel actual
            Muestra nivel, fase, estad√≠sticas y progreso
        -->
        <div class="game-ui">
            <!-- Informaci√≥n del nivel actual -->
            <div class="level-info">
                <div class="level-number" id="levelNumber">1</div>
                <div class="level-name" id="levelName">DOS REYES SOLOS</div>
                <div class="level-phase" id="levelPhase">üî∏ Estructura Base</div>
                <div class="level-description" id="levelDescription">Los reyes nunca pueden estar juntos</div>
            </div>

            <!-- Estad√≠sticas de memoria del nivel -->
            <div class="memory-stats">
                <div class="pieces-total">Piezas: <span id="piecesTotal">2</span></div>
                <div class="pieces-hidden">Ocultas: <span id="piecesHidden">2</span></div>
                <div class="view-time">Vista: <span id="viewTime">8.0s</span></div>
            </div>

            <!-- Informaci√≥n de puntuaci√≥n y progreso -->
            <div class="score-info">
                <div class="score">Score: <span id="score">0</span></div>
                <div class="accuracy">Precisi√≥n: <span id="accuracy">100%</span></div>
                <div class="progress">
                    Nivel <span id="currentLevel">1</span>/30
                </div>
            </div>
        </div>

        <!--
            Panel educativo que explica la apertura o concepto
            Se actualiza din√°micamente seg√∫n el nivel
        -->
        <div class="educational-panel" id="educationalPanel">
            <div class="panel-title" id="panelTitle">üè∞ Informaci√≥n de Apertura</div>
            <div class="panel-content" id="panelContent">
                <div class="level-explanation" id="levelExplanation">
                    ü§¥ Los reyes nunca pueden estar en casillas adyacentes
                </div>
            </div>
        </div>

        <!-- Banner Ad Superior -->
        <div class="ad-banner-top">
            <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-2472413468382197" data-ad-slot="1111111111" data-ad-format="auto"></ins>
        </div>

        <!--
            √ÅREA PRINCIPAL DEL JUEGO
            Aqu√≠ va el tablero de ajedrez y el banco de piezas
        -->
        <div class="position-display" id="positionDisplay">
            <div class="chess-board-container">

                <!--
                    TABLERO DE CHESSBOARD2.JS
                    Este div ser√° convertido en un tablero interactivo
                    por la librer√≠a Chessboard2.js
                -->
                <div class="chess-board" id="chessboard">
                    <!-- Chessboard2.js renderizar√° las casillas y piezas aqu√≠ -->
                </div>

                <!--
                    OVERLAY DE MEMORIZACI√ìN
                    Se muestra durante la fase de memorizaci√≥n con countdown
                -->
                <div class="position-overlay" id="boardOverlay" style="display:none;">
                    <div class="overlay-text" id="overlayText">¬°Memoriza la posici√≥n!</div>
                    <div class="overlay-countdown" id="overlayCountdown">8</div>
                    <div class="phase-indicator" id="phaseIndicator">üß† Fase de memoria</div>
                </div>

                <!--
                    BANCO DE PIEZAS LATERAL
                    Aqu√≠ aparecen las piezas que el usuario debe colocar
                    en el tablero usando drag & drop
                -->
                <div class="piece-bank-container" id="pieceBankContainer" style="display:none;">
                    <div class="bank-title" style="pointer-events: none; user-select: none;">Coloca en el tablero:</div>
                    <div class="piece-bank" id="pieceBank" draggable="false">
                        <!-- Las piezas draggables se generan din√°micamente aqu√≠ -->
                    </div>
                </div>
            </div>
        </div>

        <!--
            CONTROLES DEL JUEGO
            Botones principales para controlar el juego
        -->
        <div class="game-controls">
            <button class="btn btn-primary" id="startBtn">EMPEZAR NIVEL</button>
            <button class="btn btn-secondary" id="pauseBtn" disabled>PAUSA</button>
            <button class="btn btn-secondary" id="hintBtn">PISTA</button>
            <button class="btn btn-secondary" id="skipPhaseBtn">SALTAR FASE</button>
        </div>

        <!--
            FEEDBACK DE COLOCACI√ìN
            Muestra si la pieza fue colocada correcta o incorrectamente
        -->
        <div class="feedback-display" id="feedbackDisplay" style="display:none;">
            <div class="feedback-close" id="feedbackClose">‚úï</div>
            <div class="feedback-icon" id="feedbackIcon">‚úÖ</div>
            <div class="feedback-text" id="feedbackText">¬°Correcto!</div>
            <div class="feedback-explanation" id="feedbackExplanation">Has colocado la pieza en el lugar correcto</div>
        </div>

        <!--
            PANTALLA DE COMPLETAR NIVEL
            Modal que aparece cuando el usuario completa un nivel
        -->
        <div class="level-complete" id="levelCompleteScreen">
            <div class="level-complete-content">
                <div class="complete-title" id="completeTitle">¬°NIVEL COMPLETADO!</div>

                <!-- Estad√≠sticas finales del nivel -->
                <div class="complete-stats">
                    <div class="final-score">Puntuaci√≥n: <span id="finalScore">0</span></div>
                    <div class="accuracy-final">Precisi√≥n: <span id="accuracyFinal">100%</span></div>
                    <div class="time-total">Tiempo total: <span id="timeTotal">45s</span></div>
                </div>

                <!-- Informaci√≥n educativa sobre lo aprendido -->
                <div class="lesson-learned" id="lessonLearned">
                    <div class="lesson-title">üìö Has aprendido:</div>
                    <div class="lesson-content" id="lessonContent"></div>
                </div>

                <!-- Banner Ad Interstitial -->
                <div class="ad-interstitial">
                    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-2472413468382197" data-ad-slot="2222222222" data-ad-format="auto"></ins>
                </div>

                <!-- Acciones despu√©s de completar el nivel -->
                <div class="level-complete-actions">
                    <button class="btn btn-primary" id="nextLevelBtn">SIGUIENTE NIVEL</button>
                    <button class="btn btn-secondary" id="repeatLevelBtn">REPETIR NIVEL</button>
                    <button class="btn btn-secondary" id="mainMenuBtn">MEN√ö PRINCIPAL</button>
                </div>
            </div>
        </div>

        <!-- Banner Ad Inferior -->
        <div class="ad-banner-bottom">
            <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-2472413468382197" data-ad-slot="3333333333" data-ad-format="auto"></ins>
        </div>

    </div>

    <!--
        SCRIPTS - ORDEN IMPORTANTE
        1. Librer√≠as externas (Chess.js, Chessboard2.js, Howler.js)
        2. Configuraci√≥n de niveles
        3. L√≥gica principal del juego
    -->

    <!-- jQuery (requerido por Chessboard.js) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <!-- Chess.js para l√≥gica de ajedrez (CDN oficial) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>

    <!-- Chessboard.js para renderizar tablero (CDN oficial) -->
    <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
    <script>
    // Fallback si unpkg falla
    if (typeof Chessboard === 'undefined' && typeof window.Chessboard === 'undefined') {
        console.log('üö® Fallback: Cargando ChessBoard desde cdnjs...');
        const script = document.createElement('script');
        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/chessboard-1.0.0.min.js';
        document.head.appendChild(script);
    }
    </script>

    <!-- Howler.js para manejo de audio (CDN) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>

    <!-- Configuraci√≥n de los 30 niveles del juego -->
    <script src="memory-levels.js"></script>

    <!-- Controlador principal del juego con Chessboard2.js -->
    <script src="memory-matrix-cb2.js"></script>

    <!-- Inicializaci√≥n de AdSense -->
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
        (adsbygoogle = window.adsbygoogle || []).push({});
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>

    <!--
        Script de debugging opcional (solo durante desarrollo)
        Comentar o remover en producci√≥n
    -->
    <script>
        // Funci√≥n de debugging para verificar que todo est√© cargado
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üîç DEBUGGING - Verificando librer√≠as:');
            console.log('Chess.js cargado:', typeof Chess !== 'undefined');
            console.log('Chessboard2 cargado:', typeof Chessboard !== 'undefined');
            console.log('Howler cargado:', typeof Howl !== 'undefined');
            console.log('Memory Levels cargado:', typeof MEMORY_LEVELS !== 'undefined');
        });
    </script>
</body>
</html>