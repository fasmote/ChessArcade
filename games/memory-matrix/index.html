<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memory Matrix - ChessArcade</title>

    <!-- Estilos externos: ChessBoard2 library -->
    <link rel="stylesheet" href="libs/chessboard2.css">

    <!-- Estilos de ChessGameLibrary: Selector de temas de piezas -->
    <link rel="stylesheet" href="ChessGameLibrary/UI/ThemeSelector.css">

    <!-- Estilos del juego: Memory Matrix (arquitectura completa) -->
    <link rel="stylesheet" href="memory-matrix.css">
</head>
<body>
    <div class="game-container">

        <!-- ============================================
             HEADER: Título y botón principal
             ============================================ -->
        <div class="header">
            <h1>🧠 Memory Matrix</h1>
            <button id="startBtn" class="btn-primary">Comenzar</button>
        </div>

        <!-- ============================================
             THEME SELECTOR: Cambiar estilo de piezas
             Este contenedor será llenado por ThemeSelector.js
             ============================================ -->
        <div id="theme-selector-container"></div>

        <!-- ============================================
             GAME AREA: Tablero + Banco de piezas
             Layout CSS Grid responsive
             ============================================ -->
        <div class="game-area">

            <!-- Sección del tablero de ajedrez -->
            <div class="board-section">
                <!-- Este div será transformado en tablero por ChessBoard2.js -->
                <div id="chessboard"></div>
            </div>

            <!-- Sección del banco de piezas draggables -->
            <div class="pieces-section">
                <h3>Coloca las piezas:</h3>
                <!-- Este div contendrá las piezas que el jugador puede arrastrar -->
                <div id="piece-bank"></div>
            </div>

        </div>

        <!-- ============================================
             STATUS: Mensajes de estado del juego
             ============================================ -->
        <div class="status">
            <p id="status-text">Haz clic en "Comenzar" para empezar</p>
        </div>

    </div>

    <!-- ============================================
         LIBRERÍAS EXTERNAS
         ============================================ -->

    <!-- Chess.js: Lógica de ajedrez, validación de movimientos, FEN, etc. -->
    <script src="libs/chess.min.js"></script>

    <!-- ChessBoard2.js: Renderizado visual del tablero de ajedrez -->
    <script src="libs/chessboard2.min.js"></script>

    <!-- ============================================
         CHESSGAMELIBRARY - CORE
         Sistema central de comunicación y estados
         ============================================ -->

    <!-- EventBus: Sistema pub/sub para comunicación entre módulos
         Ejemplo: ThemeSelector emite 'themeChanged' → BoardManager escucha y recarga -->
    <script src="ChessGameLibrary/Core/EventBus.js"></script>

    <!-- StateManager: Gestión de estados del juego
         Estados: waiting → memorizing → placing → complete -->
    <script src="ChessGameLibrary/Core/StateManager.js"></script>

    <!-- ============================================
         CHESSGAMELIBRARY - CONFIG
         Configuraciones globales
         ============================================ -->

    <!-- PieceThemes: Configuración de temas de piezas
         Define: Lichess, Chess.com, Wikipedia, Monsters (MAG), etc.
         Maneja persistencia en localStorage -->
    <script src="ChessGameLibrary/Config/PieceThemes.js"></script>

    <!-- ============================================
         CHESSGAMELIBRARY - COMPONENTS
         Componentes reutilizables del juego
         ============================================ -->

    <!-- BoardManager: Wrapper de ChessBoard2.js
         - Inicializa tablero
         - Maneja posiciones (setPosition, getPosition, clear)
         - Escucha cambios de tema y recarga automáticamente -->
    <script src="ChessGameLibrary/Board/BoardManager.js"></script>

    <!-- PieceBank: Gestión del banco lateral de piezas
         - Crea piezas draggables
         - Usa tema dinámico (PieceThemes)
         - Remueve piezas cuando se colocan en tablero -->
    <script src="ChessGameLibrary/Pieces/PieceBank.js"></script>

    <!-- ============================================
         CHESSGAMELIBRARY - UI
         Componentes de interfaz de usuario
         ============================================ -->

    <!-- ThemeSelector: Selector visual de temas de piezas
         - Dropdown con preview de cada tema
         - Persistencia en localStorage
         - Emite evento 'themeChanged' al cambiar -->
    <script src="ChessGameLibrary/UI/ThemeSelector.js"></script>

    <!-- ============================================
         CHESSGAMELIBRARY - GAME LOGIC
         Lógica específica del juego Memory Matrix
         ============================================ -->

    <!-- MemoryLevels: Base de datos de 30 niveles
         - FENs de posiciones de Lichess
         - Partidas inmortales (Anderssen, Morphy, Fischer, Kasparov)
         - Finales artísticos (Réti, Saavedra, Lucena, Philidor)
         - Metadatos: dificultad, tiempo, piezas a memorizar -->
    <script src="ChessGameLibrary/Games/MemoryMatrix/MemoryLevels.js"></script>

    <!-- MemoryMatrixGame: Orquestador principal del juego
         - Conecta todos los componentes
         - Maneja flujo: memorizar → ocultar → colocar → verificar
         - Drag & drop con detección de casilla exacta
         - Verificación de victoria -->
    <script src="ChessGameLibrary/Games/MemoryMatrix/MemoryMatrixGame.js"></script>

    <!-- ============================================
         GAME INITIALIZATION
         Código de inicialización cuando el DOM esté listo
         ============================================ -->
    <script>
        // Variable global para acceder al juego desde consola (útil para debugging)
        let memoryMatrixGame;

        // Esperar a que el DOM esté completamente cargado
        document.addEventListener('DOMContentLoaded', function() {
            console.log('📄 DOM cargado, inicializando Memory Matrix...');

            // ==========================================
            // 1. INICIALIZAR SELECTOR DE TEMAS
            // ==========================================
            const themeSelector = new ThemeSelector('theme-selector-container', {
                position: 'top-right',      // Posición: esquina superior derecha
                showLabels: true,           // Mostrar texto "Piezas" en botón
                showDescriptions: false,    // No mostrar descripciones largas
                autoClose: true             // Cerrar dropdown al seleccionar
            });
            themeSelector.render();
            console.log('✅ ThemeSelector inicializado');

            // ==========================================
            // 2. CREAR INSTANCIA DEL JUEGO
            // ==========================================
            // MemoryMatrixGame conecta automáticamente:
            // - BoardManager (tablero)
            // - PieceBank (banco de piezas)
            // - StateManager (estados del juego)
            // - EventBus (comunicación entre componentes)
            memoryMatrixGame = new MemoryMatrixGame();

            // ==========================================
            // 3. INICIALIZAR EL JUEGO
            // ==========================================
            // Esto:
            // - Inicializa el tablero (ChessBoard2)
            // - Configura event listeners
            // - Establece estado inicial: 'waiting'
            // - Configura drag & drop desde banco al tablero
            memoryMatrixGame.initialize();

            console.log('✅ Memory Matrix inicializado correctamente');
            console.log('💡 Tip: Accede al juego desde consola con "memoryMatrixGame"');
        });
    </script>
</body>
</html>